<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>node_modules&#x2F;mojito&#x2F;lib&#x2F;app&#x2F;addons&#x2F;ac&#x2F;composite.common.js - Mojito API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http:&#x2F;&#x2F;developer.yahoo.com&#x2F;cocktails&#x2F;mojito&#x2F;api&#x2F;assets&#x2F;img&#x2F;mojito-logo-white-bkg.png" title="Mojito API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.7.5</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/ActionContext.html">ActionContext</a></li>
            
                <li><a href="..&#x2F;classes/Analytics.common.html">Analytics.common</a></li>
            
                <li><a href="..&#x2F;classes/Assets.common.html">Assets.common</a></li>
            
                <li><a href="..&#x2F;classes/Composite.common.html">Composite.common</a></li>
            
                <li><a href="..&#x2F;classes/Config.common.html">Config.common</a></li>
            
                <li><a href="..&#x2F;classes/Cookie.client.html">Cookie.client</a></li>
            
                <li><a href="..&#x2F;classes/Cookie.server.html">Cookie.server</a></li>
            
                <li><a href="..&#x2F;classes/Data.common.data.html">Data.common.data</a></li>
            
                <li><a href="..&#x2F;classes/Data.common.pageData.html">Data.common.pageData</a></li>
            
                <li><a href="..&#x2F;classes/Deploy.server.html">Deploy.server</a></li>
            
                <li><a href="..&#x2F;classes/Helpers.common.html">Helpers.common</a></li>
            
                <li><a href="..&#x2F;classes/Http.server.html">Http.server</a></li>
            
                <li><a href="..&#x2F;classes/Intl.common.html">Intl.common</a></li>
            
                <li><a href="..&#x2F;classes/Meta.common.html">Meta.common</a></li>
            
                <li><a href="..&#x2F;classes/Model.Vanilla.html">Model.Vanilla</a></li>
            
                <li><a href="..&#x2F;classes/Models.common.html">Models.common</a></li>
            
                <li><a href="..&#x2F;classes/MojitoDispatcher.html">MojitoDispatcher</a></li>
            
                <li><a href="..&#x2F;classes/MojitoPerf.html">MojitoPerf</a></li>
            
                <li><a href="..&#x2F;classes/MojitoRouter.html">MojitoRouter</a></li>
            
                <li><a href="..&#x2F;classes/MojitProxy.html">MojitProxy</a></li>
            
                <li><a href="..&#x2F;classes/OutputBuffer.html">OutputBuffer</a></li>
            
                <li><a href="..&#x2F;classes/OutputHandler.html">OutputHandler</a></li>
            
                <li><a href="..&#x2F;classes/Params.common.html">Params.common</a></li>
            
                <li><a href="..&#x2F;classes/Partial.common.html">Partial.common</a></li>
            
                <li><a href="..&#x2F;classes/ResourceStore.server.html">ResourceStore.server</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonConfig.html">RSAddonConfig</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonDispatchHelper.html">RSAddonDispatchHelper</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonMime.html">RSAddonMime</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonSelector.html">RSAddonSelector</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonUrl.html">RSAddonUrl</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonYUI.html">RSAddonYUI</a></li>
            
                <li><a href="..&#x2F;classes/Url.common.html">Url.common</a></li>
            
                <li><a href="..&#x2F;classes/Y.mojito.Client.html">Y.mojito.Client</a></li>
            
                <li><a href="..&#x2F;classes/Y.mojito.lib.REST.html">Y.mojito.lib.REST</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/ActionContext.html">ActionContext</a></li>
            
                <li><a href="..&#x2F;modules/ActionContextAddon.html">ActionContextAddon</a></li>
            
                <li><a href="..&#x2F;modules/app.html">app</a></li>
            
                <li><a href="..&#x2F;modules/CommonLibs.html">CommonLibs</a></li>
            
                <li><a href="..&#x2F;modules/Data.common.html">Data.common</a></li>
            
                <li><a href="..&#x2F;modules/model-vanilla.html">model-vanilla</a></li>
            
                <li><a href="..&#x2F;modules/mojito-perf.html">mojito-perf</a></li>
            
                <li><a href="..&#x2F;modules/MojitoClient.html">MojitoClient</a></li>
            
                <li><a href="..&#x2F;modules/MojitoHooks.html">MojitoHooks</a></li>
            
                <li><a href="..&#x2F;modules/OutputBuffer.html">OutputBuffer</a></li>
            
                <li><a href="..&#x2F;modules/ResourceStore.html">ResourceStore</a></li>
            
                <li><a href="..&#x2F;modules/ResourceStoreAddon.html">ResourceStoreAddon</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: node_modules&#x2F;mojito&#x2F;lib&#x2F;app&#x2F;addons&#x2F;ac&#x2F;composite.common.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;*
 * Copyright (c) 2011-2013, Yahoo! Inc.  All rights reserved.
 * Copyrights licensed under the New BSD License.
 * See the accompanying LICENSE file for terms.
 *&#x2F;


&#x2F;*jslint anon:true, sloppy:true, nomen:true*&#x2F;
&#x2F;*global YUI*&#x2F;


&#x2F;**
 * @module ActionContextAddon
 *&#x2F;
YUI.add(&#x27;mojito-composite-addon&#x27;, function (Y, NAME) {

    &#x2F;**
    * &lt;strong&gt;Access point:&lt;&#x2F;strong&gt; &lt;em&gt;ac.composite.*&lt;&#x2F;em&gt;
    * Provides methods for working with many Mojits.
    * @class Composite.common
    *&#x2F;
    function Addon(command, adapter, ac) {
        this.command = command;
        this.dispatch = ac._dispatch;
        this.ac = ac;
        this.adapter = adapter;
        this.queue = new Y.Parallel({
            context: this
        });
    }

    Addon.prototype = {

        namespace: &#x27;composite&#x27;,

        &#x2F;**
         * Automatically dispatches all the children of this mojit and collects
         * their executed values into the view template, keyed by the child&#x27;s
         * name within the mojit&#x27;s configuration. For example, given the mojit
         * spec:
         *
         *
&lt;pre&gt;
&quot;specs&quot;: {
    &quot;parent&quot;: {
        &quot;type&quot;: &quot;MyCompositeMojit&quot;,
         &quot;config&quot;: {
             &quot;children&quot;: {
                 &quot;foo&quot;: {
                     &quot;type&quot;: &quot;FooMojit&quot;
                 },
                 &quot;bar&quot;: {
                     &quot;type&quot;: &quot;BarMojit&quot;
                 }
             }
         }
    }
        }
&lt;&#x2F;pre&gt;
         * And given the view template:
&lt;pre&gt;
&amp;lt;div id=&amp;quot;{{mojit_view_id}}&amp;quot;&amp;gt;
&amp;lt;h1&amp;gt;{{title}}&amp;lt;&#x2F;h1&amp;gt;
&amp;lt;div class=&amp;quot;fooslot&amp;quot;&amp;gt;
    {{{foo}}}
&amp;lt;&#x2F;div&amp;gt;
&amp;lt;div class=&amp;quot;barslot&amp;quot;&amp;gt;
    {{{bar}}}
&amp;lt;&#x2F;div&amp;gt;
&amp;lt;&#x2F;div&amp;gt;
&lt;&#x2F;pre&gt;
         * And the controller:
&lt;pre&gt;
Y.mojito.controller = {
    index: function(ac) {
        ac.composite.done({
            title: &#x27;Hello there&#x27;
        });
    }
};
&lt;&#x2F;pre&gt;
         * This will execute the child intances of the &quot;FooMojit&quot; and
         * &quot;BarMojit&quot;, returning their rendered values into the parent&#x27;s view
         * template, thus rendering the full parent view including the children.
         * The API of this method is equivalent to ac.done().
         * @method done
         * @param {object} templateData The data you want return by the request.
         * @param {object} parentMeta Any meta-data required to service the request.
         *&#x2F;
        done: function (templateData, parentMeta) {
            var ac = this.ac,
                cfg = this.command.instance.config,
                children = cfg.children;

            templateData = templateData || {};
            parentMeta   = parentMeta || {};

            &#x2F;&#x2F; Backward Compatibility block
            if (templateData.template) {
                Y.log(&#x27;ac.composite.done({template:{title: &quot;...&quot;}}) is a legacy API, &#x27; +
                        &#x27;use ac.composite.done({title: &quot;...&quot;}) instead.&#x27;, &#x27;warn&#x27;, NAME);
                templateData = templateData.template;
            }

            if (!children || Y.Object.size(children) === 0) {
                throw new Error(&#x27;Cannot run composite mojit children because&#x27; +
                                &#x27; there are no children defined in the&#x27; +
                                &#x27; composite mojit spec.&#x27;);
            }

            this.execute(cfg, function (data, meta) {

                parentMeta.assets = Y.mojito.util.metaMerge(
                    parentMeta.assets || {},
                    meta.assets || {}
                );
                &#x2F;&#x2F; 1. templateData and data are normally exclusive, in which case
                &#x2F;&#x2F; the prority is not relevent. In which case we set D
                &#x2F;&#x2F; 2. parentMeta and meta should be merged to preserve the children
                &#x2F;&#x2F; binders map, assets, etc. but giving parentMeta the priority in case
                &#x2F;&#x2F; a custom configuration in the parent should overrule something coming
                &#x2F;&#x2F; from the chindren merged meta
                ac.done(Y.merge(data, templateData), Y.mojito.util.metaMerge(parentMeta, meta));

            }, this);
        },


        &#x2F;**
         * This method requires an explicit config object and returns
         * a RMP compliant object via a callback.
         *
&lt;pre&gt;
cfg = {
    children: {
        slot-1: {
            type: &quot;default&quot;,
            action: &quot;index&quot;
        },
        slot-2: {
            type: &quot;default&quot;,
            action: &quot;index&quot;,
            params: {
                route: {},
                url: {},
                body: {},
                file: {}
            }
        }
    },
    assets: {}
        }
&lt;&#x2F;pre&gt;
         *
         * The &quot;callback&quot; is an object containg the child slots with its
         * rendered data.
         *
&lt;pre&gt;
callback({
    slot-1: &lt;string&gt;,
    slot-2: &lt;string&gt;
        },
        {
   http: {}
   assets: {}
        })
&lt;&#x2F;pre&gt;
         * @method execute
         * @param {object} cfg The configuration object to be used.
         * @param {function} cb The callback that will be called.
         *&#x2F;
        execute: function (cfg, cb) {

            var ac = this.ac,
                content = {},
                my = this,
                meta = {},
                children = cfg.children || {},
                child;

            &#x2F;&#x2F; check to ensure children is an Object, not an array
            if (Y.Lang.isArray(cfg.children)) {
                throw new Error(&#x27;Cannot process children in the format of an&#x27; +
                                &#x27; array. \&#x27;children\&#x27; must be an object.&#x27;);
            }

            &#x2F;&#x2F; HookSystem::StartBlock
            Y.mojito.hooks.hook(&#x27;addon&#x27;, this.adapter.hook, &#x27;start&#x27;, my, cfg);
            &#x2F;&#x2F; HookSystem::EndBlock

            meta.children = children;

            for (child in children) {
                if (children.hasOwnProperty(child)) {
                    children[child] = this.addChild(child, children[child]);
                }
            }

            this.queue.done(function (results) {
                var i;

                &#x2F;&#x2F; HookSystem::StartBlock
                Y.mojito.hooks.hook(&#x27;addon&#x27;, my.adapter.hook, &#x27;end&#x27;, my);
                &#x2F;&#x2F; HookSystem::EndBlock

                if (my.failed) {
                    &#x2F;&#x2F; skiping due to an error during queue process
                    return;
                }

                &#x2F;&#x2F; Reference the data we want from the &quot;results&quot; into our
                &#x2F;&#x2F; &quot;content&quot; obj Also merge the meta we collected.
                for (i = 0; i &lt; results.length; i += 1) {
                    content[results[i].name] = results[i].data;
                    if (results[i].meta) {
                        meta = Y.mojito.util.metaMerge(meta,
                                results[i].meta);
                    }
                }

                &#x2F;&#x2F; Mix in the assets given via the config
                if (cfg.assets) {
                    if (!meta.assets) {
                        meta.assets = {};
                    }
                    ac.assets.mixAssets(meta.assets, cfg.assets);
                }

                cb(content, meta);
            });
        },


        &#x2F;**
         * This method allow you to add more childs into the queue of children
         * manually. By default, the &#x60;config.children&#x60; structure will be processed
         * when calling &#x60;ac.composite.done&#x60;, but you can add more childs programatically
         * before or after calling &#x60;ac.composite.done&#x60; if you need to.
         * This is useful when you want to have more control over the children collection.
         *
&lt;pre&gt;
ac.composite.addChild(&#x27;slot-1&#x27;, {
    type: &quot;foo&quot;,
    action: &quot;index&quot;
})
&lt;&#x2F;pre&gt;
         * @method addChild
         * @param {string} childName The mojit instance name that will be used
         * in a template in a form of {{{&lt;childName&gt;}}}.
         * @param {object} child The configuration object for the child.
         * @return {object} The normalized configuration object for the
         * child, in case the child has to be proxied.
         *&#x2F;
        addChild: function (childName, child) {

            var originalChild = child,
                my = this,
                childAdapter,
                newCommand,
                id;

            &#x2F;&#x2F; check to ensure children doesn&#x27;t have a null child
            &#x2F;&#x2F; in which case it will be automatically skipped to
            &#x2F;&#x2F; facilitate disabling children based on the context.
            if (!child) {
                return;
            }

            &#x2F;&#x2F; first off, check to see if this child&#x27;s execution should be
            &#x2F;&#x2F; deferred
            if (child.defer) {
                &#x2F;&#x2F; it doesn&#x27;t make sense to have a deferred child with a
                &#x2F;&#x2F; proxy, because the defer means to proxy it
                &#x2F;&#x2F; through the LazyLoad mojit
                if (Y.Lang.isObject(child.proxy)) {
                    throw new Error(&#x27;Cannot specify a child mojit spec&#x27; +
                                    &#x27; with both \&#x27;defer\&#x27; and \&#x27;proxy\&#x27;&#x27; +
                                    &#x27; configurations, because \&#x27;defer\&#x27;&#x27; +
                                    &#x27; assumes a \&#x27;proxy\&#x27; to the LazyLoad&#x27; +
                                    &#x27; mojit.&#x27;);
                }
                &#x2F;&#x2F; aha! that means we will give it a proxy to the LazyLoad
                &#x2F;&#x2F; mojit, which will handle lazy execution on the client.
                child.proxy = {
                    type: &#x27;LazyLoad&#x27;
                };
            }
            if (Y.Lang.isObject(child.proxy)) {
                &#x2F;&#x2F; found a proxy, replace the child with the proxy and shove
                &#x2F;&#x2F; the child to proxy into it
                child = child.proxy;
                child.proxied = originalChild;
                &#x2F;&#x2F; remove any defer or proxy flags so it doesn&#x27;t reload
                &#x2F;&#x2F; infinitely
                originalChild.proxy = undefined;
                originalChild.defer = false;
            }

            &#x2F;&#x2F; Make a new &quot;command&quot; that works in the context of this
            &#x2F;&#x2F; composite
            newCommand = {
                instance: child,
                &#x2F;&#x2F; use action in child spec or default to index
                action: child.action || &#x27;index&#x27;,
                context: this.command.context,
                params: child.params || this.command.params
            };

            &#x2F;&#x2F; identifier for the child (only used in the logs)
            id = NAME + &#x27;::&#x27; + (newCommand.base ? &#x27;&#x27; : &#x27;@&#x27; + newCommand.type) + &#x27;:&#x27; + newCommand.action;

            childAdapter = new Y.mojito.OutputBuffer(id, this.queue.add(function (err, data, meta) {

                &#x2F;&#x2F; HookSystem::StartBlock
                Y.mojito.hooks.hook(&#x27;adapterBuffer&#x27;, this.hook, &#x27;end&#x27;, this);
                &#x2F;&#x2F; HookSystem::EndBlock

                if (err &amp;&amp; originalChild.propagateFailure) {
                    my._onChildFailure(childName, err);
                    return;
                }

                &#x2F;&#x2F; This ends up in my.queue.results array.
                return {
                    name: childName,
                    data: (data || &#x27;&#x27;),
                    meta: meta
                };

            }));

            &#x2F;&#x2F; HookSystem::StartBlock
            Y.mojito.hooks.hook(&#x27;adapterBuffer&#x27;, this.adapter.hook, &#x27;start&#x27;, childAdapter);
            &#x2F;&#x2F; HookSystem::EndBlock

            childAdapter = Y.mix(childAdapter, this.adapter);

            this.dispatch(newCommand, childAdapter);

            return child;
        },


        _onChildFailure: function (childName, err) {
            &#x2F;&#x2F; error already reported by AdapterBuffer
            this.adapter.error(&#x27;Failed composite because of first child failure of &quot;&#x27; + childName + &#x27;&quot;&#x27;);
            &#x2F;&#x2F; cleaning up the house
            this.queue.results = [];
            &#x2F;&#x2F; cancel any pending job by invalidating the &#x60;execute&#x60; callback
            this.failed = true;
        }

    };

    Y.namespace(&#x27;mojito.addons.ac&#x27;).composite = Addon;

}, &#x27;0.1.0&#x27;, {requires: [
    &#x27;parallel&#x27;,
    &#x27;mojito&#x27;,
    &#x27;mojito-util&#x27;,
    &#x27;mojito-hooks&#x27;,
    &#x27;mojito-output-buffer&#x27;,
    &#x27;mojito-assets-addon&#x27;
]});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>

<!-- SpaceID=0 robot -->

<!-- VER-3.0.246810 -->
<!-- p2.ydn.bf1.yahoo.com uncompressed/chunked Fri Oct  4 11:13:15 PDT 2013 -->
