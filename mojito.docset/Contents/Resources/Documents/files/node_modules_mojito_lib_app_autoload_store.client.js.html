<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>node_modules&#x2F;mojito&#x2F;lib&#x2F;app&#x2F;autoload&#x2F;store.client.js - Mojito API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http:&#x2F;&#x2F;developer.yahoo.com&#x2F;cocktails&#x2F;mojito&#x2F;api&#x2F;assets&#x2F;img&#x2F;mojito-logo-white-bkg.png" title="Mojito API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.7.5</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/ActionContext.html">ActionContext</a></li>
            
                <li><a href="..&#x2F;classes/Analytics.common.html">Analytics.common</a></li>
            
                <li><a href="..&#x2F;classes/Assets.common.html">Assets.common</a></li>
            
                <li><a href="..&#x2F;classes/Composite.common.html">Composite.common</a></li>
            
                <li><a href="..&#x2F;classes/Config.common.html">Config.common</a></li>
            
                <li><a href="..&#x2F;classes/Cookie.client.html">Cookie.client</a></li>
            
                <li><a href="..&#x2F;classes/Cookie.server.html">Cookie.server</a></li>
            
                <li><a href="..&#x2F;classes/Data.common.data.html">Data.common.data</a></li>
            
                <li><a href="..&#x2F;classes/Data.common.pageData.html">Data.common.pageData</a></li>
            
                <li><a href="..&#x2F;classes/Deploy.server.html">Deploy.server</a></li>
            
                <li><a href="..&#x2F;classes/Helpers.common.html">Helpers.common</a></li>
            
                <li><a href="..&#x2F;classes/Http.server.html">Http.server</a></li>
            
                <li><a href="..&#x2F;classes/Intl.common.html">Intl.common</a></li>
            
                <li><a href="..&#x2F;classes/Meta.common.html">Meta.common</a></li>
            
                <li><a href="..&#x2F;classes/Model.Vanilla.html">Model.Vanilla</a></li>
            
                <li><a href="..&#x2F;classes/Models.common.html">Models.common</a></li>
            
                <li><a href="..&#x2F;classes/MojitoDispatcher.html">MojitoDispatcher</a></li>
            
                <li><a href="..&#x2F;classes/MojitoPerf.html">MojitoPerf</a></li>
            
                <li><a href="..&#x2F;classes/MojitoRouter.html">MojitoRouter</a></li>
            
                <li><a href="..&#x2F;classes/MojitProxy.html">MojitProxy</a></li>
            
                <li><a href="..&#x2F;classes/OutputBuffer.html">OutputBuffer</a></li>
            
                <li><a href="..&#x2F;classes/OutputHandler.html">OutputHandler</a></li>
            
                <li><a href="..&#x2F;classes/Params.common.html">Params.common</a></li>
            
                <li><a href="..&#x2F;classes/Partial.common.html">Partial.common</a></li>
            
                <li><a href="..&#x2F;classes/ResourceStore.server.html">ResourceStore.server</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonConfig.html">RSAddonConfig</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonDispatchHelper.html">RSAddonDispatchHelper</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonMime.html">RSAddonMime</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonSelector.html">RSAddonSelector</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonUrl.html">RSAddonUrl</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonYUI.html">RSAddonYUI</a></li>
            
                <li><a href="..&#x2F;classes/Url.common.html">Url.common</a></li>
            
                <li><a href="..&#x2F;classes/Y.mojito.Client.html">Y.mojito.Client</a></li>
            
                <li><a href="..&#x2F;classes/Y.mojito.lib.REST.html">Y.mojito.lib.REST</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/ActionContext.html">ActionContext</a></li>
            
                <li><a href="..&#x2F;modules/ActionContextAddon.html">ActionContextAddon</a></li>
            
                <li><a href="..&#x2F;modules/app.html">app</a></li>
            
                <li><a href="..&#x2F;modules/CommonLibs.html">CommonLibs</a></li>
            
                <li><a href="..&#x2F;modules/Data.common.html">Data.common</a></li>
            
                <li><a href="..&#x2F;modules/model-vanilla.html">model-vanilla</a></li>
            
                <li><a href="..&#x2F;modules/mojito-perf.html">mojito-perf</a></li>
            
                <li><a href="..&#x2F;modules/MojitoClient.html">MojitoClient</a></li>
            
                <li><a href="..&#x2F;modules/MojitoHooks.html">MojitoHooks</a></li>
            
                <li><a href="..&#x2F;modules/OutputBuffer.html">OutputBuffer</a></li>
            
                <li><a href="..&#x2F;modules/ResourceStore.html">ResourceStore</a></li>
            
                <li><a href="..&#x2F;modules/ResourceStoreAddon.html">ResourceStoreAddon</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: node_modules&#x2F;mojito&#x2F;lib&#x2F;app&#x2F;autoload&#x2F;store.client.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;*
 * Copyright (c) 2011-2013, Yahoo! Inc.  All rights reserved.
 * Copyrights licensed under the New BSD License.
 * See the accompanying LICENSE file for terms.
 *&#x2F;


&#x2F;*jslint anon:true, sloppy:true, nomen:true*&#x2F;
&#x2F;*global YUI*&#x2F;


YUI.add(&#x27;mojito-client-store&#x27;, function(Y, NAME) {

    var CACHE,
        QUEUED = {},
        queue,
        flushQueue,
        retrieveFile,
        isCompiled,
        trimSlash;

    &#x2F;&#x2F; TODO: use YUI.namespace()?  use generic caching instead?
    if (!YUI._mojito) {
        YUI._mojito = {};
    }

    if (!YUI._mojito._cache) {
        YUI._mojito._cache = {};
    }

    if (!YUI._mojito._cache.store) {
        YUI._mojito._cache.store = {};
    }

    CACHE = YUI._mojito._cache.store;


    queue = function(url, cb) {
        if (!QUEUED[url]) {
            QUEUED[url] = [];
        }
        QUEUED[url].push(cb);
    };


    flushQueue = function(url, err, data) {
        var i,
            q;

        if (QUEUED[url]) {
            &#x2F;&#x2F; Copy cb array out into local var to prevent further flushes from
            &#x2F;&#x2F; looping over it again.  (User-provided callbacks can take a long
            &#x2F;&#x2F; time to run, and while they are more callbacks can get queued.)
            q = QUEUED[url].splice(0, QUEUED[url].length);
            QUEUED[url] = undefined;
            for (i = 0; i &lt; q.length; i += 1) {
                &#x2F;&#x2F; We need to give each receiver a separate copy, since the
                &#x2F;&#x2F; returned data is an -object-, and changes in one will bleed
                &#x2F;&#x2F; into the others.
                q[i](err, Y.mojito.util.copy(data));
            }
        }
    };


    retrieveFile = function(url, cb) {
        &#x2F;&#x2F; iOS has a bug that returns &quot;failure&quot; on &quot;success&quot;.
        var onComplete = function(id, obj) {
            CACHE[url] = {};
            try {
                CACHE[url] = Y.JSON.parse(obj.responseText);
            } catch (err) {
                flushQueue(url, err);
                return;
            }
            flushQueue(url, null, CACHE[url]);
        };

        &#x2F;&#x2F; use the cache first
        if (CACHE[url]) {
            &#x2F;&#x2F; We need to give the receiver a separate copy, since the data is
            &#x2F;&#x2F; an -object-, and otherwise changes made by receiver will bleed
            &#x2F;&#x2F; into the cache.
            cb(null, Y.mojito.util.copy(CACHE[url]));
            return;
        }

        if (!QUEUED[url]) {
            Y.io(url, {
                headers: {
                    &#x27;x-mojito-header&#x27;: &#x27;tunnel&#x27;
                },
                on: {
                    complete: onComplete
                }
            });
        }
        queue(url, cb);
    };


    isCompiled = function(ns, specName) {
        return YUI._mojito._cache.compiled &amp;&amp;
            YUI._mojito._cache.compiled[ns] &amp;&amp;
            YUI._mojito._cache.compiled[ns].specs &amp;&amp;
            YUI._mojito._cache.compiled[ns].specs[specName];
    };


    trimSlash = function(str) {
        if (&#x27;&#x2F;&#x27; === str.charAt(str.length - 1)) {
            return str.substring(0, str.length - 1);
        }
        return str;
    };


    function ClientStore(config) {
        this.appConfig = config.appConfig;
        this.routes = config.routes;
        this.staticContext = config.context;
        this.appConfig.pathToRoot = config.pathToRoot;

        &#x2F;&#x2F; This value could be an empty string so we have to do a real check.
        this.staticPrefix = &#x27;&#x2F;static&#x27;;
        if (this.appConfig &amp;&amp; this.appConfig.staticHandling &amp;&amp;
                this.appConfig.staticHandling.hasOwnProperty(&#x27;prefix&#x27;)) {
            this.staticPrefix = (this.appConfig.staticHandling.prefix ? &#x27;&#x2F;&#x27; +
                this.appConfig.staticHandling.prefix : &#x27;&#x27;);
        }

        &#x2F;&#x2F; Now we do some bad stuff for iOS
        if (typeof window !== &#x27;undefined&#x27;) {
            this.staticPrefix = Y.mojito.util.iOSUrl(this.staticPrefix) + &#x27;&#x2F;&#x27;;
        }

        this.staticPrefix = trimSlash(this.staticPrefix);
    }

    ClientStore.prototype = {

        &#x2F;**
         * This just calls &#x60;expandInstanceForEnv()&#x60; with &#x60;env&#x60; set to &#x60;client&#x60;.
         *
         * @async
         * @method expandInstance
         * @param {map} instance partial instance to expand
         * @param {object} ctx the context
         * @param {function(err,instance)} cb callback used to return the results (or error)
         *&#x2F;
        expandInstance: function(instance, ctx, cb) {
            return this.expandInstanceForEnv(&#x27;client&#x27;, instance, ctx, cb);
        },


        &#x2F;**
         * Expands the instance into all details necessary to dispatch the mojit.
         *
         * @async
         * @method expandInstanceForEnv
         * @param {string} env the runtime environment (either &#x60;client&#x60; or &#x60;server&#x60;)
         * @param {map} instance partial instance to expand
         * @param {object} ctx the context
         * @param {function(err,instance)} cb callback used to return the results (or error)
         *&#x2F;
        expandInstanceForEnv: function(env, instance, ctx, cb) {
            var base = {},
                source = {},
                my = this;

            if (!instance.instanceId) {
                instance.instanceId = Y.guid();
                &#x2F;&#x2F;DEBUGGING:  instance.instanceId += &#x27;-instance-common-&#x27; +
                &#x2F;&#x2F;    [instance.base||&#x27;&#x27;, instance.type||&#x27;&#x27;].join(&#x27;-&#x27;);
            }

            &#x2F;&#x2F; What are being asked to expand?
            if (instance.base) {
                source.name = instance.base;
                source.func = this._getSpec;
            } else if (instance.type) {
                source.name = instance.type;
                source.func = this._getType;
            } else {
                &#x2F;&#x2F; We don&#x27;t have any inputs so fail
                throw new Error(&#x27;There was no info in the &quot;instance&quot; object&#x27;);
            }

            &#x2F;&#x2F; Here we get either the a spec or a type
            source.func.call(this, env, source.name, ctx, function(err, data) {
                if (err) {
                    cb(err, {});
                    return;
                }

                base = Y.mojito.util.mergeRecursive(data, instance);

                &#x2F;&#x2F; Ensure the &quot;instance&quot; has been properly resolved. If
                &#x2F;&#x2F; there are no specs in the application.json file, there is
                &#x2F;&#x2F; an error below because the instance is invalid. We should
                &#x2F;&#x2F; check here for a valid instance object and throw an error
                &#x2F;&#x2F; if it is not. This happens because someone could create a
                &#x2F;&#x2F; routes.json file with routes that don&#x27;t route to mojit
                &#x2F;&#x2F; instances, and the URI router creates invalid commands,
                &#x2F;&#x2F; which are passed into the dispatch.
                if (!my._validateInstance(base)) {
                    cb(new Error(&#x27;Instance was not valid. &#x27; + Y.JSON.stringify(base)), {});
                    return;
                }

                cb(null, base);
            });

        },


        &#x2F;**
         * Returns a contextualized application configuration.
         * @method getAppConfig
         * @param {object} ctx the context
         * @return {object} the application configuration contextualized by the &quot;ctx&quot; argument.
         *&#x2F;
        getAppConfig: function(ctx) {
            return this.appConfig;
        },


        &#x2F;**
         * Returns the static context used to boot the application.
         * @method getStaticContext
         * @return {object} the static context.
         *&#x2F;
        getStaticContext: function() {
            return this.staticContext;
        },


        &#x2F;**
         * Returns the static (non-runtime-sensitive) version of the application.json.
         * @method getStaticAppConfig
         * @return {object} the configuration from applications.json
         *&#x2F;
        getStaticAppConfig: function(ctx) {
            return this.appConfig;
        },


        &#x2F;**
         * Returns the routes configured in the application.
         * @method getRoutes
         * @param {object} ctx the context
         * @return {object} routes
         *&#x2F;
        getRoutes: function(ctx) {
            return this.routes;
        },


        &#x2F;**
         * Validates the context, and throws an exception if it isn&#x27;t.
         * @method validateContext
         * @param {object} ctx the context
         * @return {nothing} if this method returns at all then the context is valid
         *&#x2F;
        validateContext: function(ctx) {
            &#x2F;&#x2F; This is OK since per-context caching (which is the main reason to
            &#x2F;&#x2F; make sure that the context matches the YCB dimensions) on the
            &#x2F;&#x2F; client is less sensitive to pollution by application code.
            return true;
        },


        &#x2F;**
         * Returns, via callback, the fully expanded mojit instance specification.
         *
         * @private
         * @async
         * @method _getSpec
         * @param {string} env the runtime environment (either &#x60;client&#x60; or &#x60;server&#x60;)
         * @param {string} id the ID of the spec to return
         * @param {object} ctx the runtime context for the spec
         * @param {function} cb callback used to return the results (or error)
         * @param {Error} cb.err error encountered, or a falsy value if no error
         * @param {object} cb.spec the expanded mojit instance
         *&#x2F;
        _getSpec: function(env, id, context, cb) {
            var parts = id.split(&#x27;:&#x27;),
                typeName = parts[0],
                specName = parts[1] || &#x27;default&#x27;,
                ns = typeName.replace(&#x2F;\.&#x2F;g, &#x27;_&#x27;),
                url;

            &#x2F;&#x2F; This should really have the tunnelPrefix.  However, that
            &#x2F;&#x2F; complicates offline apps (from &#x60;mojito build html5app&#x60;).
            &#x2F;&#x2F; The mojito-handler-tunnel will be able to handle this URL
            &#x2F;&#x2F; just fine.
            url = this.staticPrefix + &#x27;&#x2F;&#x27; + typeName + &#x27;&#x2F;specs&#x2F;&#x27; + specName +
                &#x27;.json&#x27;;

            url = this._buildUrl(url, context);

            &#x2F;&#x2F; use the compiled version if there was one built
            if (isCompiled(ns, specName)) {
                CACHE[url] = YUI._mojito._cache.compiled[ns].specs[specName];
                cb(null, CACHE[url]);
                return;
            }

            retrieveFile(url, cb);
        },


        &#x2F;**
         * Returns, via callback, the details of the mojit type.
         *
         * @private
         * @async
         * @method _getType
         * @param {string} env the runtime environment (either &#x60;client&#x60; or &#x60;server&#x60;)
         * @param {string} type the mojit type
         * @param {object} ctx the runtime context for the type
         * @param {function} cb callback used to return the results (or error)
         * @param {Error} cb.err error encountered, or a falsy value if no error
         * @param {object} cb.spec the mojit type details
         *&#x2F;
        _getType: function(env, type, context, cb) {
            &#x2F;&#x2F; This should really have the tunnelPrefix.  However, that
            &#x2F;&#x2F; complicates offline apps (from &#x60;mojito build html5app&#x60;).
            &#x2F;&#x2F; The mojito-handler-tunnel will be able to handle this URL
            &#x2F;&#x2F; just fine.
            var url = this.staticPrefix + &#x27;&#x2F;&#x27; + type + &#x27;&#x2F;definition.json&#x27;;

            url = this._buildUrl(url, context);

            retrieveFile(url, cb);
        },


        &#x2F;**
         * Checks the given URL and adds a context query string.
         * @param url {String} the relative url
         * @param context {Object} the runtime context
         * @return {String}
         *&#x2F;
        _buildUrl: function (url, context) {

            if (&#x27;&#x2F;&#x27; !== url.charAt(0)) {
                url = &#x27;&#x2F;&#x27; + url;
            }

            &#x2F;&#x2F; this is mainly used by html5app
            if (this.appConfig.pathToRoot) {
                url = this.appConfig.pathToRoot + url;
            }

            if (context) {
                url += &#x27;?&#x27; + Y.QueryString.stringify(context);
            }

            return url;
        },


        _validateInstance: function(base) {
            if (!base.type) {
                return false;
            }
            return true;
        }
    };

    Y.namespace(&#x27;mojito&#x27;).ResourceStore = ClientStore;

}, &#x27;0.1.0&#x27;, {requires: [
    &#x27;mojito-util&#x27;,
    &#x27;querystring-stringify-simple&#x27;
]});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>

<!-- SpaceID=0 robot -->

<!-- VER-3.0.246810 -->
<!-- p2.ydn.bf1.yahoo.com uncompressed/chunked Fri Oct  4 11:13:25 PDT 2013 -->
