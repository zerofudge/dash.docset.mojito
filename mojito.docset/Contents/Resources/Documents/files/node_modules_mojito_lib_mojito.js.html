<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>node_modules&#x2F;mojito&#x2F;lib&#x2F;mojito.js - Mojito API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http:&#x2F;&#x2F;developer.yahoo.com&#x2F;cocktails&#x2F;mojito&#x2F;api&#x2F;assets&#x2F;img&#x2F;mojito-logo-white-bkg.png" title="Mojito API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.7.5</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/ActionContext.html">ActionContext</a></li>
            
                <li><a href="..&#x2F;classes/Analytics.common.html">Analytics.common</a></li>
            
                <li><a href="..&#x2F;classes/Assets.common.html">Assets.common</a></li>
            
                <li><a href="..&#x2F;classes/Composite.common.html">Composite.common</a></li>
            
                <li><a href="..&#x2F;classes/Config.common.html">Config.common</a></li>
            
                <li><a href="..&#x2F;classes/Cookie.client.html">Cookie.client</a></li>
            
                <li><a href="..&#x2F;classes/Cookie.server.html">Cookie.server</a></li>
            
                <li><a href="..&#x2F;classes/Data.common.data.html">Data.common.data</a></li>
            
                <li><a href="..&#x2F;classes/Data.common.pageData.html">Data.common.pageData</a></li>
            
                <li><a href="..&#x2F;classes/Deploy.server.html">Deploy.server</a></li>
            
                <li><a href="..&#x2F;classes/Helpers.common.html">Helpers.common</a></li>
            
                <li><a href="..&#x2F;classes/Http.server.html">Http.server</a></li>
            
                <li><a href="..&#x2F;classes/Intl.common.html">Intl.common</a></li>
            
                <li><a href="..&#x2F;classes/Meta.common.html">Meta.common</a></li>
            
                <li><a href="..&#x2F;classes/Model.Vanilla.html">Model.Vanilla</a></li>
            
                <li><a href="..&#x2F;classes/Models.common.html">Models.common</a></li>
            
                <li><a href="..&#x2F;classes/MojitoDispatcher.html">MojitoDispatcher</a></li>
            
                <li><a href="..&#x2F;classes/MojitoPerf.html">MojitoPerf</a></li>
            
                <li><a href="..&#x2F;classes/MojitoRouter.html">MojitoRouter</a></li>
            
                <li><a href="..&#x2F;classes/MojitProxy.html">MojitProxy</a></li>
            
                <li><a href="..&#x2F;classes/OutputBuffer.html">OutputBuffer</a></li>
            
                <li><a href="..&#x2F;classes/OutputHandler.html">OutputHandler</a></li>
            
                <li><a href="..&#x2F;classes/Params.common.html">Params.common</a></li>
            
                <li><a href="..&#x2F;classes/Partial.common.html">Partial.common</a></li>
            
                <li><a href="..&#x2F;classes/ResourceStore.server.html">ResourceStore.server</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonConfig.html">RSAddonConfig</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonDispatchHelper.html">RSAddonDispatchHelper</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonMime.html">RSAddonMime</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonSelector.html">RSAddonSelector</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonUrl.html">RSAddonUrl</a></li>
            
                <li><a href="..&#x2F;classes/RSAddonYUI.html">RSAddonYUI</a></li>
            
                <li><a href="..&#x2F;classes/Url.common.html">Url.common</a></li>
            
                <li><a href="..&#x2F;classes/Y.mojito.Client.html">Y.mojito.Client</a></li>
            
                <li><a href="..&#x2F;classes/Y.mojito.lib.REST.html">Y.mojito.lib.REST</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/ActionContext.html">ActionContext</a></li>
            
                <li><a href="..&#x2F;modules/ActionContextAddon.html">ActionContextAddon</a></li>
            
                <li><a href="..&#x2F;modules/app.html">app</a></li>
            
                <li><a href="..&#x2F;modules/CommonLibs.html">CommonLibs</a></li>
            
                <li><a href="..&#x2F;modules/Data.common.html">Data.common</a></li>
            
                <li><a href="..&#x2F;modules/model-vanilla.html">model-vanilla</a></li>
            
                <li><a href="..&#x2F;modules/mojito-perf.html">mojito-perf</a></li>
            
                <li><a href="..&#x2F;modules/MojitoClient.html">MojitoClient</a></li>
            
                <li><a href="..&#x2F;modules/MojitoHooks.html">MojitoHooks</a></li>
            
                <li><a href="..&#x2F;modules/OutputBuffer.html">OutputBuffer</a></li>
            
                <li><a href="..&#x2F;modules/ResourceStore.html">ResourceStore</a></li>
            
                <li><a href="..&#x2F;modules/ResourceStoreAddon.html">ResourceStoreAddon</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: node_modules&#x2F;mojito&#x2F;lib&#x2F;mojito.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;*
 * Copyright (c) 2011-2013, Yahoo! Inc.  All rights reserved.
 * Copyrights licensed under the New BSD License.
 * See the accompanying LICENSE file for terms.
 *&#x2F;


&#x2F;*jslint anon:true, sloppy:true, nomen:true, node:true*&#x2F;

&#x27;use strict&#x27;;

&#x2F;&#x2F;  ----------------------------------------------------------------------------
&#x2F;&#x2F;  Prerequisites
&#x2F;&#x2F;  ----------------------------------------------------------------------------


var express = require(&#x27;express&#x27;), &#x2F;&#x2F; TODO: [Issue 80] go back to connect?
    http = require(&#x27;http&#x27;),
    store = require(&#x27;.&#x2F;store&#x27;),
    OutputHandler = require(&#x27;.&#x2F;output-handler.server&#x27;),
    libpath = require(&#x27;path&#x27;),
    requestCounter = 0, &#x2F;&#x2F; used to scope logs per request
    Mojito;

&#x2F;&#x2F;  ----------------------------------------------------------------------------
&#x2F;&#x2F;  Mojito Global
&#x2F;&#x2F;  ----------------------------------------------------------------------------


&#x2F;**
 * Shared global object, which isn&#x27;t named &#x27;mojito&#x27; because &#x27;mojito&#x27; is a module
 * name defined in mojito.common.js and required via Y.use.
 *&#x2F;
&#x2F;&#x2F; TODO: Merge what we put on this object with the &#x27;mojito&#x27; module&#x2F;namespace.
global._mojito = {};


&#x2F;&#x2F;  ----------------------------------------------------------------------------
&#x2F;&#x2F;  MojitoServer
&#x2F;&#x2F;  ----------------------------------------------------------------------------


&#x2F;**
 * The primary Mojito server type. Invoking the constructor returns an instance
 * which is not yet running. Use listen to run the server once you have made
 * any adjustments to its configuration.
 * @param {{port: number,
 *          dir: string,
 *          context: Object,
 *          appConfig: Object,
 *          verbose: boolean}} options An object containing server options. The
 *          default port is process.env.PORT or port 8666 if no port is given.
 *          Verbose is false by default. Dir is cwd() by default. Both the
 *          context and appConfig will default to empty objects.
 * @constructor
 * @return {MojitoServer}
 *&#x2F;
function MojitoServer(options) {
    var appConfig;

    this._options = options || {};
    this._options.port = this._options.port || process.env.PORT || 8666;
    this._options.dir = this._options.dir || process.cwd();
    this._options.context = this._options.context || {};
    this._options.mojitoRoot = __dirname;

    &#x2F;&#x2F; TODO: Note we could pass some options to the express server instance.
    this._app = express.createServer();

    appConfig = store.getAppConfig(this._options.dir, this._options.context);
    this._options.Y = this._createYUIInstance(this._options, appConfig);
    this._configureLogger(this._options.Y);
    this._app.store = store.createStore(this._options);
    this._configureAppInstance(this._app, this._options, appConfig);
    this._app.store.optimizeForEnvironment();

    return this;
}


&#x2F;&#x2F;  ---------
&#x2F;&#x2F;  Constants
&#x2F;&#x2F;  ---------

&#x2F;**
 * An ordered list of the middleware module names to load for a standard Mojito
 * server instance.
 * @type {Array.&lt;string&gt;}
 *&#x2F;
MojitoServer.MOJITO_MIDDLEWARE = [
    &#x27;mojito-handler-static&#x27;,
    &#x27;mojito-parser-body&#x27;,
    &#x27;mojito-parser-cookies&#x27;,
    &#x27;mojito-contextualizer&#x27;,
    &#x27;mojito-handler-tunnel&#x27;,
    &#x27;mojito-router&#x27;,
    &#x27;mojito-handler-dispatcher&#x27;,
    &#x27;mojito-handler-error&#x27;
];


&#x2F;&#x2F;  ------------------
&#x2F;&#x2F;  Private Attributes
&#x2F;&#x2F;  ------------------


&#x2F;**
 * The Express application (server) instance.
 * @type {Object}
 *&#x2F;
MojitoServer.prototype._app = null;


&#x2F;**
 * The formatting function for the server&#x27;s associated logger.
 * @type {function(string, number, string, Date, Object, number)}
 *&#x2F;
MojitoServer.prototype._logFormatter = null;


&#x2F;**
 * The publisher function for the server&#x27;s associated logger.
 * @type {function(string, number, string, Date, number)}
 *&#x2F;
MojitoServer.prototype._logPublisher = null;


&#x2F;**
 * The write function for the server&#x27;s associated logger.
 * @type {function(function(string, number, string, Date, Object, number))}
 *&#x2F;
MojitoServer.prototype._logWriter = null;


&#x2F;**
 * The server options container. Common option keys are listed.
 * @type {{port: number,
 *          dir: string,
 *          context: Object,
 *          appConfig: Object,
 *          verbose: boolean}}
 *&#x2F;
MojitoServer.prototype._options = null;


&#x2F;**
 * The server startup time. This value is used to both provide startup&#x2F;uptime
 * information and as a signifier that the server has been configured&#x2F;started.
 * @type {number}
 *&#x2F;
MojitoServer.prototype._startupTime = null;


&#x2F;&#x2F;  ---------------
&#x2F;&#x2F;  Private Methods
&#x2F;&#x2F;  ---------------

&#x2F;**
 * A utility function for compiling a list of middleware
 * @method _makeMiddewareList
 * @private
 * @param {array} app_mw Middleware list specified by the app&#x27;s applicatioon.json
 * @param {array} mojito_mw Middeware list specified Mojito, in this file, by the
 * MojitoServer.MOJITO_MIDDLEWARE property
 * @return {array} Complete and ordered list of middleware to load
 *&#x2F;
MojitoServer.prototype._makeMiddewareList = function (app_mw, mojito_mw) {
    var m,
        hasMojito = false,
        midName,
        middleware = [];

    &#x2F;&#x2F; computing middleware pieces
    if (app_mw &amp;&amp; app_mw.length) {
        for (m = 0; m &lt; app_mw.length; m += 1) {
            midName = app_mw[m];
            if (0 === midName.indexOf(&#x27;mojito-&#x27;)) {
                hasMojito = true;
                break;
            }
        }

        if (hasMojito) {
            &#x2F;&#x2F; User has specified at least one of mojito&#x27;s middleware, so
            &#x2F;&#x2F; we assume that they have specified all that they need.
            middleware = app_mw;
        } else {
            &#x2F;&#x2F; backwards compatibility mode:
            &#x2F;&#x2F;  middlware = user&#x27;s, then mojito&#x27;s
            middleware = app_mw.concat(mojito_mw);
        }

    } else {
        middleware = mojito_mw;
    }

    return middleware;
};

&#x2F;**
 * A utility function to require middleware code, configure it, and tell express
 * to use() it.
 * @method _useMiddleware
 * @private
 * @param {object} app Express app instance.
 * @param {function} dispatcher Dispatcher function wrapper, special case middleware.
 * @param {string} midDir Directory of user-specified middleware, if any.
 * @param {object} midConfig Configuration object.
 * @param {array} middleware Middleware names, or pathnames.
 *&#x2F;
MojitoServer.prototype._useMiddleware = function (app, dispatcher, midDir, midConfig, middleware) {
    var m,
        midName,
        midPath,
        midBase,
        midFactory;

    for (m = 0; m &lt; middleware.length; m += 1) {
        midName = middleware[m];
        if (0 === midName.indexOf(&#x27;mojito-&#x27;)) {
            &#x2F;&#x2F; one special one, since it might be difficult to move to a
            &#x2F;&#x2F; separate file
            if (midName === &#x27;mojito-handler-dispatcher&#x27;) {
                &#x2F;&#x2F;console.log(&quot;======== MIDDLEWARE mojito -- &quot; +
                &#x2F;&#x2F;    &quot;builtin mojito-handler-dispatcher&quot;);
                app.use(dispatcher);
            } else {
                midPath = libpath.join(__dirname, &#x27;app&#x27;, &#x27;middleware&#x27;, midName);
                &#x2F;&#x2F;console.log(&quot;======== MIDDLEWARE mojito &quot; + midPath);
                midFactory = require(midPath);
                app.use(midFactory(midConfig));
            }
        } else {
            &#x2F;&#x2F; backwards-compatibility: user-provided middleware is
            &#x2F;&#x2F; specified by path
            midPath = libpath.join(midDir, midName);
            &#x2F;&#x2F;console.log(&quot;======== MIDDLEWARE user &quot; + midPath);
            midBase = libpath.basename(midPath);
            if (0 === midBase.indexOf(&#x27;mojito-&#x27;)) {
                &#x2F;&#x2F; Same as above (case of Mojito&#x27;s special middlewares)
                &#x2F;&#x2F; Gives a user-provided middleware access to the YUI
                &#x2F;&#x2F; instance, resource store, logger, context, etc.
                app.use(require(midPath)(midConfig));
            } else {
                app.use(require(midPath));
            }
        }
    }
};

&#x2F;**
 * Creates the YUI instance.
 * @private
 * @method _createYUIInstance
 * @param {Object} options The options as passed to the constructor.
 * @param {Object} appConfig The static application configuration.
 * @return {Object} The YUI instances.
 *&#x2F;
MojitoServer.prototype._createYUIInstance = function(options, appConfig) {
    var yuiConfig = (appConfig.yui &amp;&amp; appConfig.yui.config) || {},
        Y;

    &#x2F;&#x2F; redefining &quot;combine&quot; and&#x2F;or &quot;base&quot; in the server side have side effects
    &#x2F;&#x2F; and might try to load yui from CDN, so we bypass them.
    &#x2F;&#x2F; TODO: report bug.
    &#x2F;&#x2F; is there a better alternative for this delete?
    &#x2F;&#x2F; maybe not, but it might introduce a perf penalty
    &#x2F;&#x2F; in v8 engine, and we can&#x27;t use the undefined trick
    &#x2F;&#x2F; because loader is doing hasOwnProperty :(
    delete yuiConfig.combine;
    delete yuiConfig.base;

    &#x2F;&#x2F; in case we want to collect some performance metrics,
    &#x2F;&#x2F; we can do that by defining the &quot;perf&quot; object in:
    &#x2F;&#x2F; application.json (master)
    &#x2F;&#x2F; You can also use the option --perf path&#x2F;filename.log when
    &#x2F;&#x2F; running mojito start to dump metrics to disk.
    if (appConfig.perf) {
        yuiConfig.perf = appConfig.perf;
        yuiConfig.perf.logFile = options.perf || yuiConfig.perf.logFile;
    }

    &#x2F;&#x2F; getting yui module, or yui&#x2F;debug if needed, and applying
    &#x2F;&#x2F; the default configuration from application.json-&gt;yui-config
    Y = require(&#x27;yui&#x27; + (yuiConfig.filter === &#x27;debug&#x27; ? &#x27;&#x2F;debug&#x27; : &#x27;&#x27;)).YUI(yuiConfig, {
        useSync: true
    });

    return Y;
};

&#x2F;**
 * Adds Mojito framework components to the Express application instance.
 * @private
 * @method _configureAppInstance
 * @param {Object} app The Express application instance to Mojito-enable.
 * @param {{port: number,
 *          dir: string,
 *          context: Object,
 *          appConfig: Object,
 *          verbose: boolean}} options An object containing server options.
 * @param {Object} appConfig The static application configuration.
 *&#x2F;
MojitoServer.prototype._configureAppInstance = function(app, options, appConfig) {
    var store = app.store,
        Y = options.Y,
        modules = [],
        middleware,
        midConfig;

    modules = this._configureYUI(Y, store);

    &#x2F;&#x2F; attaching all modules available for this application for the server side
    Y.applyConfig({ useSync: true });
    Y.use.apply(Y, modules);
    Y.applyConfig({ useSync: false });

    middleware = this._makeMiddewareList(appConfig.middleware, MojitoServer.MOJITO_MIDDLEWARE);

    midConfig = {
        Y: Y,
        store: store,
        logger: {
            log: Y.log
        },
        context: options.context
    };

    function dispatcher(req, res, next) {
        var command = req.command,
            outputHandler,
            context = req.context || {};

        if (!command) {
            next();
            return;
        }

        outputHandler = new OutputHandler(req, res, next);
        outputHandler.setLogger({
            log: Y.log
        });

        &#x2F;&#x2F; storing the static app config as well as contextualized app config per request
        outputHandler.page.staticAppConfig = store.getStaticAppConfig();
        outputHandler.page.appConfig = store.getAppConfig(context);
        &#x2F;&#x2F; compute routes once per request
        outputHandler.page.routes = store.getRoutes(context);

        &#x2F;&#x2F; HookSystem::StartBlock
        &#x2F;&#x2F; enabling perf group
        if (appConfig.perf) {
            &#x2F;&#x2F; in case another middleware has enabled hooks before
            outputHandler.hook = req.hook || {};
            Y.mojito.hooks.enableHookGroup(outputHandler.hook, &#x27;mojito-perf&#x27;);
        }
        &#x2F;&#x2F; HookSystem::EndBlock

        &#x2F;&#x2F; HookSystem::StartBlock
        Y.mojito.hooks.hook(&#x27;AppDispatch&#x27;, outputHandler.hook, req, res);
        &#x2F;&#x2F; HookSystem::EndBlock

        Y.mojito.Dispatcher.init(store).dispatch(command, outputHandler);
    }

    &#x2F;&#x2F; attach middleware pieces
    this._useMiddleware(app, dispatcher, options.dir, midConfig, middleware);

    Y.log(&#x27;Mojito HTTP Server initialized in &#x27; +
            ((new Date().getTime()) - Mojito.MOJITO_INIT) + &#x27;ms.&#x27;);
};

&#x2F;*
 * Configures YUI logger to honor the logLevel and logLevelOrder
 * TODO: this should be done at the low level in YUI.
 *&#x2F;
MojitoServer.prototype._configureLogger = function(Y) {
    var logLevel = (Y.config.logLevel || &#x27;debug&#x27;).toLowerCase(),
        logLevelOrder = Y.config.logLevelOrder || [],
        defaultLogLevel = logLevelOrder[0] || &#x27;info&#x27;,
        isatty = process.stdout.isTTY;

    function log(c, msg, cat, src) {
        var f,
            m = (src) ? src + &#x27;: &#x27; + msg : msg;

        &#x2F;&#x2F; if stdout is bound to the tty, we should try to
        &#x2F;&#x2F; use the fancy logs implemented by &#x27;yui-log-nodejs&#x27;.
        &#x2F;&#x2F; TODO: eventually YUI should take care of this piece.
        if (isatty &amp;&amp; Y.Lang.isFunction(c.logFn)) {
            c.logFn.call(Y, msg, cat, src);
        } else if ((typeof console !== &#x27;undefined&#x27;) &amp;&amp; console.log) {
            f = (cat &amp;&amp; console[cat]) ? cat : &#x27;log&#x27;;
            console[f](msg);
        }
    }

    &#x2F;&#x2F; one more hack: we need to make sure that base is attached
    &#x2F;&#x2F; to be able to listen for Y.on.
    Y.use(&#x27;base&#x27;);

    if (Y.config.debug) {

        logLevel = (logLevelOrder.indexOf(logLevel) &gt;= 0 ? logLevel : logLevelOrder[0]);

        &#x2F;&#x2F; logLevel index defines the begining of the logLevelOrder structure
        &#x2F;&#x2F; e.g: [&#x27;foo&#x27;, &#x27;bar&#x27;, &#x27;baz&#x27;], and logLevel &#x27;bar&#x27; should produce: [&#x27;bar&#x27;, &#x27;baz&#x27;]
        logLevelOrder = (logLevel ? logLevelOrder.slice(logLevelOrder.indexOf(logLevel)) : []);

        Y.applyConfig({
            useBrowserConsole: false,
            logLevel: logLevel,
            logLevelOrder: logLevelOrder
        });

        &#x2F;&#x2F; listening for low level log events to filter some of them.
        Y.on(&#x27;yui:log&#x27;, function (e) {
            var c = Y.config,
                cat = e &amp;&amp; e.cat &amp;&amp; e.cat.toLowerCase();

            &#x2F;&#x2F; this covers the case Y.log(msg) without category
            &#x2F;&#x2F; by using the low priority category from logLevelOrder.
            cat = cat || defaultLogLevel;

            &#x2F;&#x2F; applying logLevel filters
            if (cat &amp;&amp; ((c.logLevel === cat) || (c.logLevelOrder.indexOf(cat) &gt;= 0))) {
                log(c, e.msg, cat, e.src);
            }
            return true;
        });
    }

};

&#x2F;**
 * Configures YUI with both the Mojito framework and all the YUI modules in the
 * application.
 * @private
 * @method _configureYUI
 * @param {object} Y YUI object to configure
 * @param {object} store Resource Store which knows what to load
 * @return {array} array of YUI module names
 *&#x2F;
MojitoServer.prototype._configureYUI = function(Y, store) {
    var modules,
        load,
        lang;

    modules = store.yui.getModulesConfig(&#x27;server&#x27;, false);
    Y.applyConfig(modules);

    load = Object.keys(modules.modules);

    &#x2F;&#x2F; NOTE:  Not all of these module names are guaranteed to be valid,
    &#x2F;&#x2F; but the loader tolerates them anyways.
    for (lang in store.yui.langs) {
        if (store.yui.langs.hasOwnProperty(lang) &amp;&amp; lang) {
            load.push(&#x27;lang&#x2F;datatype-date-format_&#x27; + lang);
        }
    }

    return load;
};


&#x2F;&#x2F;  --------------
&#x2F;&#x2F;  Public Methods
&#x2F;&#x2F;  --------------


&#x2F;**
 * Closes (shuts down) the server port and stops the server.
 *&#x2F;
MojitoServer.prototype.close = function() {
    if (this._options.verbose) {
        console.warn(&#x27;Closing Mojito Application&#x27;);
    }

    this._app.close();
};


&#x2F;**
 * Returns the instance of http.Server (or a subtype) which is the true server.
 * @return {http.Server} The node.js http.Server (or subtype) instance.
 *&#x2F;
MojitoServer.prototype.getHttpServer = function() {
    return this._app;
};


&#x2F;**
 * Begin listening for inbound connections.
 * @param {Number} port The port number. Defaults to the server&#x27;s value for
 *     options.port (which defaults to process.env.PORT followed by 8666).
 * @param {String} host Optional hostname or IP address in string form.
 * @param {Function} callback Optional callback to get notified when the
 * server is ready to server traffic.
 *&#x2F;
MojitoServer.prototype.listen = function(port, host, callback) {

    var app = this._app,
        p = port || this._options.port,
        h = host || this._options.host,
        listenArgs = [p];

    &#x2F;&#x2F; Track startup time and use it to ensure we don&#x27;t try to listen() twice.
    if (this._startupTime) {
        if (this._options.verbose) {
            console.warn(&#x27;Mojito Application Already Running&#x27;);
        }
        return;
    }
    this._startupTime = new Date().getTime();

    if (this._options.verbose) {
        console.warn(&#x27;Starting Mojito Application&#x27;);
    }

    if (h) {
        listenArgs.push(h);
    }

    &#x2F;&#x2F; close on app for callback
    function handler(err) {
        callback(err, app);
    }

    if (callback) {
        app.on(&#x27;error&#x27;, handler);
        listenArgs.push(handler);
    }

    app.listen.apply(app, listenArgs);
};


&#x2F;**
 * Invokes a callback function with the content of the requested url.
 * @param {string} url A url to fetch.
 * @param {{host: string, port: number, method: string}|function} opts A list of
 *     options, or a callback function (See @param for cb). When providing
 *     options note that the list here is not exhaustive. Any valid http.request
 *     object option may be provided. See documentation for http.request.
 * @param {function(Error, string, string)} cb A function called on request
 *     completion. Parameters are any optional Error, the original URL, and the
 *     content of that URL.
 *&#x2F;
MojitoServer.prototype.getWebPage = function(url, opts, cb) {
    var buffer = &#x27;&#x27;,
        callback,
        options = {
            host: &#x27;127.0.0.1&#x27;,
            port: this._options.port,
            path: url,
            method: &#x27;get&#x27;
        };

    &#x2F;&#x2F; Options block is optional, no pun intended. When it&#x27;s a function we&#x27;ll
    &#x2F;&#x2F; use that as our callback function.
    if (typeof opts === &#x27;function&#x27;) {
        callback = opts;
    } else {
        &#x2F;&#x2F; Don&#x27;t assume we got a real callback function.
        callback = cb || Mojito.NOOP;

        &#x2F;&#x2F; Map provided options into our request options object.
        Object.keys(opts).forEach(function(k) {
            if (opts.hasOwnProperty(k)) {
                options[k] = opts[k];
            }
        });
    }

    http.request(options, function(res) {
        res.setEncoding(&#x27;utf8&#x27;);
        res.on(&#x27;data&#x27;, function(chunk) {
            buffer += chunk;
        });
        res.on(&#x27;end&#x27;, function() {
            &#x2F;&#x2F; TODO: 200 isn&#x27;t the only success code. Support 304 etc.
            if (res.statusCode !== 200) {
                callback(&#x27;Could not get web page: status code: &#x27; +
                    res.statusCode + &#x27;\n&#x27; + buffer, url);
            } else {
                callback(null, url, buffer);
            }
        });
    }).on(&#x27;error&#x27;, function(err) {
        callback(err, url);
    }).end();
};


&#x2F;**
 * Invokes a callback function with the content of each url requested.
 * @param {Array.&lt;string&gt;} urls A list of urls to fetch.
 * @param {function(Error, string, string)} cb A function called once for each
 *     url in the urls list. Parameters are any optional Error, the original URL
 *     and the URL&#x27;s content.
 *&#x2F;
MojitoServer.prototype.getWebPages = function(urls, cb) {
    var server = this,
        callback,
        count,
        len,
        initOne;

    &#x2F;&#x2F; If no array, or an empty array, just exit.
    if (!urls || urls.length === 0) {
        return;
    }

    &#x2F;&#x2F; NOTE we could just say this is an error condition. No callback, what&#x27;s
    &#x2F;&#x2F; the point of doing the work?
    callback = cb || Mojito.NOOP;

    len = urls.length;
    count = 0;

    &#x2F;&#x2F; Create a function to call getWebPage with an individual URL shifted from
    &#x2F;&#x2F; the list. When the list is empty we can stop.
    initOne = function() {
        if (count &lt; len) {
            server.getWebPage(urls[count], function(err, url, data) {
                count += 1;
                try {
                    callback(err, url, data);
                } finally {
                    initOne();
                }
            });
        }
    };

    &#x2F;&#x2F; Start the ball rolling :).
    initOne();
};

&#x2F;&#x2F;  ----------------------------------------------------------------------------
&#x2F;&#x2F;  Mojito
&#x2F;&#x2F;  ----------------------------------------------------------------------------

&#x2F;**
 * The Mojito object is the primary server construction interface for Mojito.
 * This object is used to create new server instances but given that the raw
 * Express application object is expected&#x2F;returned there&#x27;s no need for a true
 * constructor since there are no true instances of a Mojito server object.
 *&#x2F;
&#x2F;&#x2F; TODO: Merge what we put on this object with the &#x27;mojito&#x27; module&#x2F;namespace.
Mojito = {};


&#x2F;&#x2F;  ---------
&#x2F;&#x2F;  Constants
&#x2F;&#x2F;  ---------

&#x2F;**
 * The date&#x2F;time the Mojito object was initialized.
 * @type {Date}
 *&#x2F;
Mojito.MOJITO_INIT = new Date().getTime();


&#x2F;**
 * A placeholder function used to avoid overhead checking for callbacks.
 * @type {function()}
 *&#x2F;
Mojito.NOOP = function() {};


&#x2F;&#x2F;  --------------
&#x2F;&#x2F;  Public Methods
&#x2F;&#x2F;  --------------


&#x2F;**
 * Creates a properly configured MojitoServer instance and returns it.
 * @method createServer
 * @param {Object} options Options for starting the app.
 * @return {Object} Express application.
 *&#x2F;
Mojito.createServer = function(options) {
    &#x2F;&#x2F; NOTE that we use the exported name here. This allows us to mock that
    &#x2F;&#x2F; object during testing.
    return new Mojito.Server(options);
};


&#x2F;**
 * Allows the bin&#x2F;mojito command to leverage the current module&#x27;s relative path
 * for initial startup loading.
 * @method include
 * @param {string} path The path used to locate resources.
 * @return {Object} The return value of require() for the adjusted path.
 *&#x2F;
Mojito.include = function(path) {
    return require(&#x27;.&#x2F;&#x27; + path);
};


&#x2F;&#x2F;  ----------------------------------------------------------------------------
&#x2F;&#x2F;  EXPORT(S)
&#x2F;&#x2F;  ----------------------------------------------------------------------------

&#x2F;**
 * Export Mojito as the return value for any require() calls.
 * @type {Mojito}
 *&#x2F;
module.exports = Mojito;

&#x2F;**
 * Export Mojito.Server to support unit testing of the server type. With this
 * approach the slot for the server can be replaced with a mock, but the actual
 * MojitoServer type remains private to the module.
 * @type {MojitoServer}
 *&#x2F;
module.exports.Server = MojitoServer;


    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>

<!-- SpaceID=0 robot -->

<!-- VER-3.0.246810 -->
<!-- p2.ydn.bf1.yahoo.com uncompressed/chunked Fri Oct  4 11:13:21 PDT 2013 -->
